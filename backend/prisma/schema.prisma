// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  SITE_ADMIN
  GOVT_DEPARTMENT
  TOURIST_GUIDE
  USER
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ContentType {
  LOCATION
  EVENT
  PACKAGE
  ACCOMMODATION
}

enum AccommodationType {
  HOTEL
  RESORT
  RESTAURANT
  HOME_STAY
  SHARED_FLAT
}

enum PriceCategory {
  BUDGET
  MID_RANGE
  LUXURY
  PREMIUM
}

enum DietType {
  VEGETARIAN
  VEGAN
  NON_VEGETARIAN
  JAIN
  HALAL
  KOSHER
  GLUTEN_FREE
  ORGANIC
}

enum HomeStaySubtype {
  ENTIRE_HOME
  PRIVATE_ROOM
  SHARED_ROOM
  FARM_STAY
  HERITAGE_HOME
  ECO_STAY
  BEACH_HOUSE
  MOUNTAIN_COTTAGE
}

enum GenderPreference {
  MALE_ONLY
  FEMALE_ONLY
  MIXED
  NO_PREFERENCE
}

enum CallRequestStatus {
  NEW
  CONTACTED
  QUALIFIED
  FOLLOW_UP
  SCHEDULED
  CONVERTED
  LOST
  INVALID
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum CallOutcome {
  CONNECTED
  NO_ANSWER
  BUSY
  WRONG_NUMBER
  VOICEMAIL
  CALLBACK_REQUESTED
}

enum InteractionType {
  CALL
  EMAIL
  SMS
  WHATSAPP
  NOTE
  STATUS_CHANGE
}

enum BookingCategory {
  HOTEL
  FLIGHT
  BUS
  TRAIN
  SHIP
}

enum GroupTravelStatus {
  OPEN
  CLOSED
  COMPLETED
}

enum BidApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}

enum MediaType {
  IMAGE
  VIDEO
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  role      UserRole
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  profile                     UserProfile?
  locations                   Location[]
  events                      Event[]
  packages                    Package[]
  accommodations              Accommodation[]             @relation("AccommodationCreator")
  communityPosts              CommunityPost[]
  eventInterests              EventInterest[]
  packageInterests            PackageInterest[]
  groupTravels                GroupTravel[]
  travelBids                  TravelBid[]
  followers                   Follow[]                    @relation("UserFollowers")
  following                   Follow[]                    @relation("UserFollowing")
  conversationsUser1          ChatConversation[]          @relation("User1Conversations")
  conversationsUser2          ChatConversation[]          @relation("User2Conversations")
  messages                    ChatMessage[]
  chatRequestsSent            ChatRequest[]               @relation("ChatRequestSender")
  chatRequestsReceived        ChatRequest[]               @relation("ChatRequestReceiver")
  notifications               Notification[]
  comments                    Comment[]
  postLikes                   PostLike[]
  groupTravelInterests        GroupTravelInterest[]
  approvedContent             ApprovalQueue[]
  callbackStatusChanges       CallbackStatusHistory[]
  assignedCallRequests        AccommodationCallRequest[]  @relation("AssignedCallRequests")
  callInteractions            CallInteraction[]           @relation("CallInteractions")
  callStatusHistory           CallStatusHistory[]         @relation("CallStatusHistory")
  accommodationReviews        AccommodationReview[]       @relation("AccommodationReviews")
  savedPosts                  SavedPost[]
  followRequestsSent          FollowRequest[]             @relation("FollowRequestSender")
  followRequestsReceived      FollowRequest[]             @relation("FollowRequestReceiver")
  blocking                    BlockedUser[]               @relation("UserBlocking")
  blockedBy                   BlockedUser[]               @relation("UserBlocked")
  muting                      MutedUser[]                 @relation("UserMuting")
  mutedBy                     MutedUser[]                 @relation("UserMuted")
  postReports                 PostReport[]                @relation("PostReporter")
  reviewedReports             PostReport[]                @relation("PostReviewer")
  albums                      Album[]                     @relation("UserAlbums")
  photoComments               PhotoComment[]              @relation("PhotoComments")
  commentReports              CommentReport[]             @relation("CommentReporter")
  reviewedCommentReports      CommentReport[]             @relation("CommentReviewer")

  @@map("users")
}

model UserProfile {
  id            String   @id @default(uuid())
  userId        String   @unique
  name          String
  phone         String?
  avatar        String?
  bio           String?
  isCelebrity   Boolean  @default(false)
  isInfluencer  Boolean  @default(false)
  stateAssignment String? // For Govt Department
  isPrivate     Boolean  @default(false)
  followerCount Int      @default(0)
  followingCount Int     @default(0)
  postCount     Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_profiles")
}

model Location {
  id             String         @id @default(uuid())
  country        String
  state          String
  area           String
  description    String
  images         String[]
  latitude       Float?
  longitude      Float?
  howToReach     String?
  nearestAirport String?
  airportDistance String?
  nearestRailway String?
  railwayDistance String?
  nearestBusStation String?
  busStationDistance String?
  attractions    String[]
  kidsAttractions String[]
  createdBy      String
  createdByRole  UserRole
  approvalStatus ApprovalStatus @default(PENDING)
  approvedBy     String?
  approvedAt     DateTime?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  creator        User            @relation(fields: [createdBy], references: [id])
  events         Event[]
  packages       Package[]
  communityPosts CommunityPost[]

  @@map("locations")
}

model EventType {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("event_types")
}

model Event {
  id                  String         @id @default(uuid())
  title               String
  description         String
  eventType           String         // Festival, Concert, Sports, Cultural, Religious, etc.
  locationId          String?
  customCountry       String?
  customState         String?
  customArea          String?
  venue               String?        // Specific venue name
  startDate           DateTime
  endDate             DateTime
  images              String[]
  nearestAirport      String?
  airportDistance     String?
  nearestRailway      String?
  railwayDistance     String?
  nearestBusStation   String?
  busStationDistance  String?
  hostId              String
  hostRole            UserRole
  approvalStatus      ApprovalStatus @default(PENDING)
  isActive            Boolean        @default(true)
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt

  host             User                    @relation(fields: [hostId], references: [id])
  location         Location?               @relation(fields: [locationId], references: [id])
  interestedUsers  EventInterest[]
  callbackRequests EventCallbackRequest[]

  @@map("events")
}

model EventInterest {
  id            String   @id @default(uuid())
  eventId       String
  userId        String
  contactShared Boolean  @default(true)
  createdAt     DateTime @default(now())

  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
  @@map("event_interests")
}

enum CallbackStatus {
  PENDING
  CONTACTED
  RESCHEDULED
  NOT_INTERESTED
  BOOKING_COMPLETED
}

model EventCallbackRequest {
  id          String         @id @default(uuid())
  eventId     String
  name        String
  phone       String
  email       String?
  message     String?
  userId      String?        // Optional - if user is logged in
  status      CallbackStatus @default(PENDING)
  notes       String?        // Admin/Host notes about the conversation
  contactedAt DateTime?      // When they were contacted
  contactedBy String?        // Who contacted them
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@map("event_callback_requests")
}

model Package {
  id             String         @id @default(uuid())
  title          String
  description    String
  duration       Int // days
  locationId     String?
  customCountry  String?
  customState    String?
  customArea     String?
  price          Float
  images         String[]
  hostId         String
  hostRole       UserRole
  approvalStatus ApprovalStatus @default(PENDING)
  isActive       Boolean        @default(true)
  isArchived     Boolean        @default(false)
  archivedAt     DateTime?
  archivedBy     String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  host             User                      @relation(fields: [hostId], references: [id])
  location         Location?                 @relation(fields: [locationId], references: [id])
  itinerary        ItineraryDay[]
  interestedUsers  PackageInterest[]
  callbackRequests PackageCallbackRequest[]

  @@map("packages")
}

model ItineraryDay {
  id          String   @id @default(uuid())
  packageId   String
  day         Int
  title       String
  description String
  activities  String[]

  package Package @relation(fields: [packageId], references: [id], onDelete: Cascade)

  @@map("itinerary_days")
}

model PackageInterest {
  id            String   @id @default(uuid())
  packageId     String
  userId        String
  contactShared Boolean  @default(true)
  createdAt     DateTime @default(now())

  package Package @relation(fields: [packageId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([packageId, userId])
  @@map("package_interests")
}

model PackageCallbackRequest {
  id              String         @id @default(uuid())
  packageId       String
  name            String
  phone           String
  email           String?
  message         String?
  userId          String?        // Optional - if user is logged in
  status          CallbackStatus @default(PENDING)
  notes           String?
  rescheduleDate  DateTime?
  contactedAt     DateTime?
  contactedBy     String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  package       Package                   @relation(fields: [packageId], references: [id], onDelete: Cascade)
  statusHistory CallbackStatusHistory[]

  @@map("package_callback_requests")
}

model CallbackStatusHistory {
  id                String         @id @default(uuid())
  callbackRequestId String
  status            CallbackStatus
  notes             String?
  changedBy         String
  createdAt         DateTime       @default(now())

  callbackRequest PackageCallbackRequest @relation(fields: [callbackRequestId], references: [id], onDelete: Cascade)
  user            User                   @relation(fields: [changedBy], references: [id])

  @@map("callback_status_history")
}

model Accommodation {
  id                String              @id @default(uuid())
  type              AccommodationType
  name              String
  slug              String              @unique
  description       String
  
  // Location (REQUIRED)
  country           String
  state             String
  area              String
  address           String?
  latitude          Float
  longitude         Float
  mapUrl            String?
  
  // Contact
  phone             String[]
  email             String?
  website           String?
  
  // Media
  images            String[]
  videos            String[]
  virtualTourUrl    String?
  
  // Pricing
  priceMin          Float?
  priceMax          Float?
  currency          String              @default("INR")
  priceCategory     PriceCategory?
  
  // Ratings
  starRating        Int?
  userRating        Float?
  reviewCount       Int                 @default(0)
  
  // Amenities
  amenities         String[]
  
  // Restaurant specific
  dietTypes         DietType[]
  cuisineTypes      String[]
  seatingCapacity   Int?
  
  // Home Stay specific
  homeStaySubtype   HomeStaySubtype?
  totalRooms        Int?
  sharedFacilities  String[]
  privateFacilities String[]
  houseRules        String?
  genderPreference  GenderPreference?
  
  // SEO
  metaTitle         String?
  metaDescription   String?
  keywords          String[]
  
  // Status
  isActive          Boolean             @default(true)
  isFeatured        Boolean             @default(false)
  approvalStatus    ApprovalStatus      @default(PENDING)
  
  // Timestamps
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  createdBy         String
  approvedBy        String?
  approvedAt        DateTime?
  
  // Relations
  creator           User                @relation("AccommodationCreator", fields: [createdBy], references: [id])
  callRequests      AccommodationCallRequest[]
  reviews           AccommodationReview[]
  
  @@index([type])
  @@index([country, state, area])
  @@index([latitude, longitude])
  @@index([slug])
  @@index([isActive, approvalStatus])
  @@map("accommodations")
}

model AccommodationCallRequest {
  id                String              @id @default(uuid())
  
  // Lead Information
  name              String
  phone             String
  email             String?
  preferredCallTime DateTime?
  message           String?
  
  // Source Tracking
  accommodationId   String
  sourceUrl         String?
  ipAddress         String?
  userAgent         String?
  
  // Assignment
  assignedTo        String?
  assignedAt        DateTime?
  
  // Status
  status            CallRequestStatus   @default(NEW)
  priority          Priority            @default(MEDIUM)
  
  // Scheduling
  scheduledCallDate DateTime?
  reminderSent      Boolean             @default(false)
  
  // Outcome
  outcome           CallOutcome?
  conversionValue   Float?
  
  // Timestamps
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  lastContactedAt   DateTime?
  convertedAt       DateTime?
  
  // Relations
  accommodation     Accommodation       @relation(fields: [accommodationId], references: [id], onDelete: Cascade)
  assignedAdmin     User?               @relation("AssignedCallRequests", fields: [assignedTo], references: [id])
  interactions      CallInteraction[]
  statusHistory     CallStatusHistory[]
  
  @@index([status])
  @@index([assignedTo])
  @@index([scheduledCallDate])
  @@index([accommodationId])
  @@map("accommodation_call_requests")
}

model CallInteraction {
  id              String              @id @default(uuid())
  callRequestId   String
  
  // Interaction Details
  type            InteractionType
  outcome         CallOutcome?
  duration        Int?
  notes           String
  nextAction      String?
  
  // Scheduling
  followUpDate    DateTime?
  
  // Metadata
  createdAt       DateTime            @default(now())
  createdBy       String
  
  // Relations
  callRequest     AccommodationCallRequest @relation(fields: [callRequestId], references: [id], onDelete: Cascade)
  admin           User                @relation("CallInteractions", fields: [createdBy], references: [id])
  
  @@index([callRequestId])
  @@map("call_interactions")
}

model CallStatusHistory {
  id              String              @id @default(uuid())
  callRequestId   String
  
  fromStatus      CallRequestStatus?
  toStatus        CallRequestStatus
  reason          String?
  notes           String?
  
  createdAt       DateTime            @default(now())
  createdBy       String
  
  callRequest     AccommodationCallRequest @relation(fields: [callRequestId], references: [id], onDelete: Cascade)
  admin           User                @relation("CallStatusHistory", fields: [createdBy], references: [id])
  
  @@index([callRequestId])
  @@map("call_status_history")
}

model AccommodationReview {
  id                String            @id @default(uuid())
  accommodationId   String
  userId            String
  
  rating            Int
  title             String?
  review            String
  
  // Moderation
  isApproved        Boolean           @default(false)
  approvedBy        String?
  approvedAt        DateTime?
  
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  
  accommodation     Accommodation     @relation(fields: [accommodationId], references: [id], onDelete: Cascade)
  user              User              @relation("AccommodationReviews", fields: [userId], references: [id])
  
  @@index([accommodationId])
  @@index([isApproved])
  @@map("accommodation_reviews")
}

model CommunityPost {
  id            String      @id @default(uuid())
  userId        String
  locationId    String?
  customCountry String?
  customState   String?
  customArea    String?
  caption       String
  mediaUrls     String[]
  mediaTypes    MediaType[]
  isHidden      Boolean     @default(false)
  hiddenAt      DateTime?
  hiddenBy      String?
  likeCount     Int         @default(0)
  commentCount  Int         @default(0)
  saveCount     Int         @default(0)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  location    Location?     @relation(fields: [locationId], references: [id])
  comments    Comment[]
  likes       PostLike[]
  savedBy     SavedPost[]
  reports     PostReport[]
  albumPhotos AlbumPhoto[]  @relation("AlbumPhotos")

  @@index([userId])
  @@index([locationId])
  @@index([createdAt])
  @@index([isHidden])
  @@map("community_posts")
}

model Comment {
  id        String   @id @default(uuid())
  postId    String
  userId    String
  text      String
  createdAt DateTime @default(now())

  post CommunityPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  user User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@map("comments")
}

model PostLike {
  id        String   @id @default(uuid())
  postId    String
  userId    String
  createdAt DateTime @default(now())

  post CommunityPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  user User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
  @@index([userId])
  @@index([postId])
  @@map("post_likes")
}

model Follow {
  id          String   @id @default(uuid())
  followerId  String
  followingId String
  createdAt   DateTime @default(now())

  follower  User @relation("UserFollowers", fields: [followerId], references: [id], onDelete: Cascade)
  following User @relation("UserFollowing", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@map("follows")
}

model GroupTravel {
  id            String            @id @default(uuid())
  title         String
  description   String
  locationId    String?
  customCountry String?
  customState   String?
  customArea    String?
  travelDate    DateTime
  expiryDate    DateTime
  creatorId     String
  status        GroupTravelStatus @default(OPEN)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  creator         User                  @relation(fields: [creatorId], references: [id])
  interestedUsers GroupTravelInterest[]
  bids            TravelBid[]

  @@map("group_travels")
}

model GroupTravelInterest {
  id            String   @id @default(uuid())
  groupTravelId String
  userId        String
  createdAt     DateTime @default(now())

  groupTravel GroupTravel @relation(fields: [groupTravelId], references: [id], onDelete: Cascade)
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupTravelId, userId])
  @@map("group_travel_interests")
}

model TravelBid {
  id                   String            @id @default(uuid())
  groupTravelId        String
  guideId              String
  numberOfDays         Int
  accommodationDetails String
  foodDetails          String
  transportDetails     String
  totalCost            Float
  approvalStatus       BidApprovalStatus @default(PENDING)
  canContact           Boolean           @default(false)
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt

  groupTravel   GroupTravel @relation(fields: [groupTravelId], references: [id], onDelete: Cascade)
  guide         User        @relation(fields: [guideId], references: [id])
  dailyItinerary DailyPlan[]

  @@map("travel_bids")
}

model DailyPlan {
  id            String @id @default(uuid())
  bidId         String
  day           Int
  activities    String
  meals         String
  accommodation String

  bid TravelBid @relation(fields: [bidId], references: [id], onDelete: Cascade)

  @@map("daily_plans")
}

model ChatConversation {
  id        String   @id @default(uuid())
  user1Id   String
  user2Id   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user1    User          @relation("User1Conversations", fields: [user1Id], references: [id], onDelete: Cascade)
  user2    User          @relation("User2Conversations", fields: [user2Id], references: [id], onDelete: Cascade)
  messages ChatMessage[]

  @@unique([user1Id, user2Id])
  @@map("chat_conversations")
}

model ChatMessage {
  id             String   @id @default(uuid())
  conversationId String
  senderId       String
  message        String
  createdAt      DateTime @default(now())

  conversation ChatConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender       User             @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@map("chat_messages")
}

model ChatRequest {
  id         String         @id @default(uuid())
  senderId   String
  receiverId String
  status     ApprovalStatus @default(PENDING)
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt

  sender   User @relation("ChatRequestSender", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User @relation("ChatRequestReceiver", fields: [receiverId], references: [id], onDelete: Cascade)

  @@unique([senderId, receiverId])
  @@map("chat_requests")
}

model BookingAPIConfig {
  id          String          @id @default(uuid())
  category    BookingCategory
  provider    String
  apiEndpoint String
  apiKey      String
  isActive    Boolean         @default(true)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@map("booking_api_configs")
}

model ApprovalQueue {
  id              String         @id @default(uuid())
  contentType     ContentType
  contentId       String
  submittedBy     String
  submittedByRole UserRole
  status          ApprovalStatus @default(PENDING)
  reviewedBy      String?
  reviewedAt      DateTime?
  rejectionReason String?
  createdAt       DateTime       @default(now())

  reviewer User? @relation(fields: [reviewedBy], references: [id])

  @@map("approval_queue")
}

model SavedPost {
  id        String   @id @default(uuid())
  userId    String
  postId    String
  createdAt DateTime @default(now())

  user User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  post CommunityPost @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
  @@index([userId])
  @@map("saved_posts")
}

model FollowRequest {
  id          String         @id @default(uuid())
  followerId  String
  followingId String
  status      ApprovalStatus @default(PENDING)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  follower  User @relation("FollowRequestSender", fields: [followerId], references: [id], onDelete: Cascade)
  following User @relation("FollowRequestReceiver", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followingId, status])
  @@map("follow_requests")
}

model BlockedUser {
  id        String   @id @default(uuid())
  blockerId String
  blockedId String
  createdAt DateTime @default(now())

  blocker User @relation("UserBlocking", fields: [blockerId], references: [id], onDelete: Cascade)
  blocked User @relation("UserBlocked", fields: [blockedId], references: [id], onDelete: Cascade)

  @@unique([blockerId, blockedId])
  @@index([blockerId])
  @@map("blocked_users")
}

model MutedUser {
  id        String   @id @default(uuid())
  muterId   String
  mutedId   String
  createdAt DateTime @default(now())

  muter User @relation("UserMuting", fields: [muterId], references: [id], onDelete: Cascade)
  muted User @relation("UserMuted", fields: [mutedId], references: [id], onDelete: Cascade)

  @@unique([muterId, mutedId])
  @@index([muterId])
  @@map("muted_users")
}

model PostReport {
  id         String   @id @default(uuid())
  postId     String
  reporterId String
  category   String
  reason     String?
  status     String   @default("pending")
  reviewedBy String?
  reviewedAt DateTime?
  createdAt  DateTime @default(now())

  post     CommunityPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  reporter User          @relation("PostReporter", fields: [reporterId], references: [id], onDelete: Cascade)
  reviewer User?         @relation("PostReviewer", fields: [reviewedBy], references: [id])

  @@unique([postId, reporterId])
  @@map("post_reports")
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  title     String
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

// Photo Albums Feature
enum AlbumPrivacy {
  PUBLIC
  FRIENDS_ONLY
  PRIVATE
}

enum CommentStatus {
  ENABLED
  DISABLED
  HIDDEN
}

model Album {
  id                    String        @id @default(uuid())
  userId                String
  name                  String
  description           String?
  privacy               AlbumPrivacy  @default(PUBLIC)
  defaultCommentStatus  CommentStatus @default(ENABLED)
  coverPhotoUrl         String?
  photoCount            Int           @default(0)
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  
  user                  User          @relation("UserAlbums", fields: [userId], references: [id], onDelete: Cascade)
  photos                AlbumPhoto[]
  
  @@index([userId])
  @@index([privacy])
  @@index([createdAt])
  @@map("albums")
}

model AlbumPhoto {
  id                String        @id @default(uuid())
  albumId           String
  postId            String
  photoUrl          String
  commentStatus     CommentStatus @default(ENABLED)
  order             Int           @default(0)
  addedAt           DateTime      @default(now())
  
  album             Album         @relation(fields: [albumId], references: [id], onDelete: Cascade)
  post              CommunityPost @relation("AlbumPhotos", fields: [postId], references: [id], onDelete: Cascade)
  comments          PhotoComment[]
  
  @@unique([albumId, postId])
  @@index([albumId])
  @@index([postId])
  @@map("album_photos")
}

enum ReportCategory {
  SPAM
  HARASSMENT
  INAPPROPRIATE_CONTENT
  HATE_SPEECH
  OTHER
}

enum ReportStatus {
  PENDING
  REVIEWED
  DISMISSED
  ACTION_TAKEN
}

model PhotoComment {
  id              String         @id @default(uuid())
  albumPhotoId    String
  userId          String
  text            String
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  
  albumPhoto      AlbumPhoto     @relation(fields: [albumPhotoId], references: [id], onDelete: Cascade)
  user            User           @relation("PhotoComments", fields: [userId], references: [id], onDelete: Cascade)
  reports         CommentReport[]
  
  @@index([albumPhotoId])
  @@index([userId])
  @@index([createdAt])
  @@map("photo_comments")
}

model CommentReport {
  id              String         @id @default(uuid())
  commentId       String
  reporterId      String
  category        ReportCategory
  reason          String?
  status          ReportStatus   @default(PENDING)
  reviewedBy      String?
  reviewedAt      DateTime?
  actionTaken     String?
  createdAt       DateTime       @default(now())
  
  comment         PhotoComment   @relation(fields: [commentId], references: [id], onDelete: Cascade)
  reporter        User           @relation("CommentReporter", fields: [reporterId], references: [id])
  reviewer        User?          @relation("CommentReviewer", fields: [reviewedBy], references: [id])
  
  @@unique([commentId, reporterId])
  @@index([commentId])
  @@index([reporterId])
  @@index([status])
  @@map("comment_reports")
}
